< https://maloam.github.io/aloa/



Some thoughts on Meta's API to GET data
---------------------------------------



OWASP Top 10 for Web still shows Broken Access Control (BAC) as 
their number one implication of privacy.

To illustrate the concern, we take a closer look at an example 
URL of a GET request. 
The base path points to a jpg image file hosted on Instagram's 
Content Delivery Network (CDN); everything after ? is metadata.


    https://scontent-ham3-1.cdninstagram.com/v/t51.82787-15/590834062_17846357859614968_6281198737803484374_n.jpg?
    stp=dst-jpg_e35_tt6
    &_nc_cat=104
    &ig_cache_key=Mzc3NjUzMjc1MjIwMDM4OTU4MA%3D%3D.3-ccb7-5
    &ccb=7-5&_nc_sid=58cdad
    &efg=eyJ2ZW5jb2RlX3RhZyI6InhwaWRzLjE0NDB4MTQ0MC5zZHIuQzMifQ%3D%3D
    &_nc_ohc=R5HVKJ5Svm8Q7kNvwGA3m5d&_nc_oc=AdmJYibDEMy7W10NVoCxZiGJTFfVRv6OC2NPxXQStk7dtEYrxQ837AGm_CuA0oRZne9WfzOFGibzTlQ55M5aCibu
    &_nc_ad=z-m
    &_nc_cid=0
    &_nc_zt=23
    &_nc_ht=scontent-ham3-1.cdninstagram.com
    &_nc_gid=whkSg5YhtkWQIU6aMLYPYA
    &oh=00_AfhPxmvQSuFePsjfqDJQkbTG-JlsR1taIcubIrdOo03CDA&oe=6930CC20



Let's break down the the parameters.

    Parameter                Example Value                Description
                                                 
    stp                |     dst-jpg_e35_tt6      |       "Specifies the image processing and format: 
                       |                          |        dst-jpg: Output as JPEG.
                       |                          |        e35:     Processing profile (often for high-res or cropped images)
                       |                          |        tt6:     Transformation tag (e.g., resize or effect variant)."
                       |                          |
    _nc_cat            |     104                  |       Network Cache Category 
                       |                          |       – Routes to specific CDN server clusters for efficient delivery.
                       |                          |
    ig_cache_key       |Mzc3NjUzMjc1MjIwMDM4OTU4  |       "Instagram-specific cache key (base64-encoded unique ID for the image version, with version flags).
                       |MA%3D%3D.3-ccb7-5         |        Ensures the correct cached copy is served."
                       |                          |
    ccb                |     7-5                  |       Cache Control Bypass 
                       |                          |       – Internal flag for cache behavior or compatibility (common fixed values like 7-4/7-5).
                       |                          |
    _nc_sid            |     58cdad               |       Network Cache Session/Server ID – Helps with CDN routing.
                       |                          |
    efg                |eyJ2ZW5jb2RlX3RhZyI6Inhwa |       "Encoded Feature Group 
                       |WRzLjE0NDB4MTQ0MC5zZHIuQzM|       – Base64-encoded metadata (here: specifies resolution like 1440x1440, SDR, quality C3)."
                       |ifQ%3D%3D                 |
                       |                          |
    _nc_ohc            |R5HVKJ5Svm8Q7kNvwGA3m5d   |       Network Cache Object Hash – Hash for the cached image object.
                       |                          |
    _nc_oc             |AdmJYibDEMy7W10NVoCxZiGJT |       "Optimization or occlusion cache parameter (internal, less documented)."
                       |FfVRv6OC2NPxXQStk7dtEYrxQ |
                       |837AGm_CuA0oRZne9WfzOFGibz|
                       |TlQ55M5aCibu              |
                       |                          |
    _nc_ad             |     z-m                  |       "Ad-related flags, cache ID, and zone/type (often default/zero for non-ad images)."
    _nc_cid            |     0                    |
    _nc_zt             |     23                   |
                       |                          |
    _nc_ht             |scontent-ham3-1.          |       Original Network Cache Host 
                       |cdninstagram.com          |       – The CDN server that processed the image.
                       |                          |
    _nc_gid            |whkSg5YhtkWQIU6aMLYPYA    |       Group/Generation ID for the cache entry.
                       |                          |
    oh                 |00_AfhPxmvQSuFePsjfqDJQkbT|       Output Hash – Integrity hash for the image (prevents tampering; mismatch causes errors).
                       |G-JlsR1taIcubIrdOo03CDA   |
                       |                          |
    oe                 |      6930CC20            |       "Output Expiry 
                       |                          |       – Hex Unix timestamp for URL expiration (here: December 3, 2025, ~23:47 UTC). 
                       |                          |       Prevents permanent direct links."
                       |                          |


Security Considerations
-----------------------


There a many parameters against tampering, i. e. the efg Parameter.
The temporal aspect of an image is also taken care of by introducing 
the oh and oe parameters to prevent the time sensitive aspect of the attack.


Decoding of the efg Parameter
-----------------------------


EFG may stand for Encoded Feature Group and is part of Meta's video/image 
serving infrastructure. It helps the CDN select the correct pre-transcoded 
version of the media and ensures consistent delivery 
(e.g., device-optimized resolution and quality).

The Parameter was introduced in March 2015. [0]

The value is a base64url-encoded JSON object, typically containing a single key: 
"vencode_tag" (short for video/image encode tag).
The vencode_tag (short for video/image encode tag) is an internal Meta/Facebook/Instagram identifier 
specifying how the media was encoded and should be served. 
In our Example, it specifies a high-res SDR JPEG at 1440x1440 with C3 compression.

Example:

    eyJ2ZW5jb2RlX3RhZyI6InhwaWRzLjE0NDB4MTQ0MC5zZHIuQzMifQ==

    {
        "vencode_tag": "xpids.1440x1440.sdr.C3"
    }



    Component               Value                   Meaning

    Source/Prefix    | xpids                | "Likely indicates a specific encoding pipeline or source type for images 
                     |                      | (e.g., ""xpi"" for cross-posted images or a specific image transcoding profile; 
                     |                      | ""xpids"" is seen in high-res Instagram feed/post images). Different prefixes exist for videos (e.g., vts for stories, vtc for clips)."
                     |                      |
    Resolution       | 1440x1440            | "The image is encoded/served at 1440 pixels by 1440 pixels (square, high-resolution variant, 
                     |                      | often the maximum or near-max for Instagram posts)."
                     |                      |
    Dynamic Range    | sdr                  | "Standard Dynamic Range (non-HDR; regular color/brightness range, as opposed to hdr for high dynamic range content)."
                     |                      |
    Quality Tier     | C3                   | "Internal quality/compression level. Meta uses tiers like C1 (highest quality), 
                     |                      | C2, C3 (balanced/good quality with efficient compression). C3 is a common mid-high tier for optimal file size vs. visual quality."
                     |                      |



The oh (Output Hash) and oe (Output Expiry) parameters
------------------------------------------------------


The oh parameter effectively expires deleted photos/videos from the CDN by 
invalidating old URLs immediately upon deletion.
Futhermore, as a cryptographic signature, it prohibits tampering of e.g. resolution or cache keys.
If mismatched or invalid, the CDN returns errors like "Bad URL Hash".
It was introduced in October 2012 as part of Facebook's integration with Akamai.


The oe parameter was likely introduced around the same time as oh (2012) or shortly after, 
as part of the signed URL system.
It holds effectively the value of a hex-encoded Unix timestamp indicating when the signed URL expires.
Example : 6930CC20 (hex) → 1763597344 (decimal) → approximately December 3, 2025.
After this time, the URL becomes invalid (even if the hash is correct), showing errors like 
"URL signature expired".



Resources

0
https://hackerfactor.com/blog/index.php?archives/948-Meta-Changes-at-Facebook.html, 30.12.2025
